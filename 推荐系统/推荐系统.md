## 电影推荐系统

### 项目系统架构

<img src="https://raw.githubusercontent.com/whn961227/images/master/data/20200825144259.png" style="zoom:80%;" />

【数据存储部分】

**业务数据库：**项目采用广泛应用的文档数据库 MongDB 作为主数据库，主要负责平台业务逻辑数据的存储。

【离线推荐部分】

**离线统计服务：**批处理统计性业务采用 Spark Core + Spark SQL 进行实现，实现对指标类数据的统计任务。

**离线推荐服务：**离线推荐业务采用 Spark Core + Spark MLlib 进行实现，采用 ALS 算法进行实现

【实时推荐部分】

**日志采集服务：**通过利用 Flume-ng 对业务平台中用户对于电影的一次评分行为 进行采集，实时发送到 Kafka 集群。

**消息缓冲服务：**项目采用 Kafka 作为流式数据的缓存组件，接受来自 Flume 的 数据采集请求。并将数据推送到项目的实时推荐系统部分。

**实时推荐服务：**项目采用 Spark Streaming 作为实时推荐系统，通过接收 Kafka 中缓存的数据，通过设计的推荐算法实现对实时推荐的数据处理，并将结构合并更 新到 MongoDB 数据库。

### 项目数据流程

<img src="https://raw.githubusercontent.com/whn961227/images/master/data/20200825144842.png"  />

【系统初始化部分】

0. 通过 Spark SQL 将系统初始化数据加载到 MongoDB 中

【离线推荐部分】

1. 离线统计服务从 MongoDB 中加载数据，将【电影平均评分统计】、【电影评分个数 统计】、【最近电影评分个数统计】三个统计算法进行运行实现，并将计算结果回写到 MongoDB 中；离线推荐服务从 MongoDB 中加载数据，通过 ALS 算法分别将【用户推荐结果矩阵】、【影片相似度矩阵】回写到 MongoDB 中。

【实时推荐部分】

2. Flume 从综合业务服务的运行日志中读取日志更新，并将更新的日志实时推送到 Kafka 中；Kafka 在收到这些日志之后，通过 kafkaStream 程序对获取的日志信息进行 过滤处理，获取用户评分数据流【UID|MID|SCORE|TIMESTAMP】，并发送到另外一个 Kafka 队列；Spark Streaming 监听 Kafka 队列，实时获取 Kafka 过滤出来的用户评分数据流，融合存储在 Redis 中的用户最近评分队列数据，提交给实时推荐算法， 完成对用户新的推荐结果计算；计算完成之后，将新的推荐结构和 MongDB 数据库中的推荐结果进行合并。

