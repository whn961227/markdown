## 网络

### 计算机网络体系结构

#### 五层协议

* **应用层：**为特定应用程序提供数据传输服务，例如 **HTTP**、**DNS** 、**SMTP**、**FTP**、**Telnet**等协议。数据单位为报文
* **传输层：**为主机中的进程提供通用数据传输服务。运输层包括两层协议：传输控制协议 **TCP**，提供面向连接、可靠的数据传输服务，数据单位为**报文段**；用户数据报协议 **UDP**，提供无连接、尽最大努力的数据传输服务，数据单位为**用户数据报**。TCP 主要提供完整性服务，UDP 主要提供及时性服务
* **网络层：**为主机提供数据传输服务。网络层把传输层传递下来的报文段和用户数据报封装成**分组**，包括 **IP**、**ARP** 协议
* **数据链路层：**主机之间可以有很多链路，链路层协议就是为同一链路的主机提供数据传输服务。数据链路层把网络层传下来的分组封装成**帧**，包括 **MAC** 协议
* **物理层：**考虑的是怎样在传输媒体上传输数据比特流，而不是指具体的传输媒体。物理层的作用是尽可能屏蔽传输媒体和通信手段的差异，使数据链路层感觉不到这些差异

#### OSI

* **表示层：**数据压缩、加密以及数据描述，这使得应用程序不必关心在各台主机中数据内部格式不同的问题
* **会话层：**建立及管理会话

#### TCP/IP

将数据链路层和物理层合并为**网络接口层**

TCP/IP 体系结构不严格遵循 OSI 分层概念，应用层可能会直接使用 IP 层或者网络接口层

#### 数据在各层之间的传递过程

在向下的过程中，需要**添加下层协议所需要的首部或者尾部**，而在向上的过程中不断**拆开首部和尾部**

**路由器**只有下面三层协议，因为路由器位于网络核心中，不需要为进程或者应用程序提供服务，因此也就不需要传输层和应用层

### HTTP（超文本传输协议）

#### 基础概念

**URI（Uniform Resource Identifier）：**统一资源标识符，包含 URL 和 URN

**URL（Uniform Resource Locator）：**统一资源定位符，https://www.google.com

**URN（Uniform Resource Name）：**统一资源名称，`urn:isbn:0451450523`

#### 特点

##### 优点

1. **简单**

   HTTP 基本的报文格式是 `header + body`，头部信息是 `key-value`简单文本的形式，易于理解

2. **灵活和易于扩展**

   HTTP 协议里的各类请求方法，URI/URL，状态码，头字段等每个组成要求都没有被固定死，都允许开发人员**自定义和扩充**

   同时 HTTP 由于是工作在应用层，则它**下层可以随意变化**，例如，HTTPS 就是在 HTTP 与 TCP 层之间增加了 SSL/TLS 安全传输层

3. **应用广泛和跨平台**

##### 缺点

1. **无状态：**

   好处：因为服务器不会去记忆 HTTP 的状态，所以不需要额外的资源来记录状态信息，这能减轻服务器的负担，能够把更多的 CPU 和内存用来对外提供服务

   坏处：在完成关联性的操作时会非常麻烦，例如 `登录 -> 添加购物车 -> 下单 -> 结算 -> 支付`，这系列操作都要知道用户的身份才行，但服务器不知道这些请求是有关联的，每次都要问一遍身份信息

   解决：用 **Cookie** 技术

   

2. 

**支持客户端、服务器端模式：**客户端向服务器端请求服务时，只需传送请求方法和路径

**无连接的：**限制每次连接只处理一个请求，当客户端再次发送请求时就是一个新的连接，采用这种方式可以节省传输时间

**这是 HTTP/1.0 版的主要缺点，**每个 TCP 连接只能发送一个请求，发送数据完毕后，连接就关闭了，如果还有请求就必须要新建一个请求连接

HTTP 1.1 虽然是无状态协议，但是为了实现期望的保持状态功能，引入了 Cookie 技术，可以管理状态

<img src="https://raw.githubusercontent.com/whn961227/images/master/data/20200810121152.png" style="zoom: 33%;" />

<img src="https://raw.githubusercontent.com/whn961227/images/master/data/20200810121243.png" style="zoom: 33%;" />

TCP 连接的新建成本很高，因为需要客户端和服务器端三次握手

HTTP 1.1 可以持久连接，TCP 连接默认不关闭，可以被多个请求复用，只有在一段时间内，没有请求，就可以自动关闭

#### HTTP 消息结构

##### 请求报文

<img src="https://raw.githubusercontent.com/whn961227/images/master/data/20200811113929.png" style="zoom: 33%;" />

##### 响应报文

<img src="https://raw.githubusercontent.com/whn961227/images/master/data/20200811114418.png" style="zoom: 33%;" />

##### 请求方法

###### HTTP 1.0

**GET：**获取资源

**HEAD：**获取报文首部，和 GET 方法类似，但是不返回报文实体主体部分

**POST：**传输实体主体

> **Get 和 Post 的区别：**
>
> Get 方法的含义是请求从服务器获取资源，这个资源可以是静态的文本 、页面、图片、视频等
>
> Post 方法向 URI 指定的资源提交数据，数据就放在报文的 body 里
>
> 安全和幂等：
>
> 『安全』：请求方法不会破坏服务器上的资源
>
> 『幂等』：多次执行相同的操作，结果都是相同的
>
> **GET 方法**是**安全且幂等**的，因为它是只读操作，无论操作多少次，服务器上的数据都是安全的，且每次的结果都是相同的
>
> **POST 方法**是新增或提交数据操作，会修改服务器上的资源，所以是**不安全**的，且多次提交数据会创建多个资源，所以**不是幂等**的

###### HTTP 1.1

**PUT：**上传文件

**PATCH：**对资源进行部分修改

**DELETE：**删除文件

**OPTIONS：**查询支持的方法

**CONNECT：**要求在与代理服务器通信时建立隧道

**TRACE：**追踪路径

##### 状态码

| 状态码 | 类别                             | 含义                       |
| ------ | -------------------------------- | -------------------------- |
| 1XX    | Informartional（信息性状态码）   | 接收的请求正在处理         |
| 2XX    | Success（成功状态码）            | 请求正常处理完毕           |
| 3XX    | Redirection（重定向状态码）      | 需要进行附加操作以完成请求 |
| 4XX    | Client Error（客户端错误状态码） | 服务器无法处理请求         |
| 5XX    | Server Error（服务器错误状态码） | 服务器处理请求出错         |

* 100 Continue：表明到目前为止都很正常，客户端可以继续发送请求或者忽略这个响应
* **200 OK：服务器响应成功，服务器找到了客户端请求的内容 ，并将内容发给了客户端**
* 204 No Content：请求已经成功处理，但是返回的响应报文不包含实体的主体部分。一般在只需要从客户端往服务器发送信息，而不需要返回数据时使用
* 206 Partial Content：表示客户端进行了范围请求，响应报文包含由 Content-Range 指定范围的实体内容
* **301 Moved Permanently：永久性重定向**
* **302 Found：临时性重定向**
* 303 See Other：和 302 有着相同的功能，但是 303 明确要求客户端应该采用 Get 方法获取资源
* **304 Not Modified：**如果请求报文首部包含一些条件，如果不满足条件，则服务器会返回 304 状态码
* 307 Temporary Redirect：临时性重定向，与 302 的含义类似，但是 307 要求浏览器不会把重定向请求的 POST 方法改成 GET 方法
* **400 Bad Request：请求报文中存在语法错误，无法被服务器解析**
* 401 Unauthorized：该状态码表示发送的请求需要有认证信息（BASIC 认证、DIGEST 认证）。如果之前已进行过一次请求，则表示用户认证失败
* **403 Forbidden：请求被拒绝**
* **404 Not Found：服务器上没有该资源，或者说是服务器上没有找到客户端请求的资源**
* **500 Internal Server Error：服务器正在执行请求时发生错误**
* **501 Not Implemented：**表示客户端请求的功能还不支持
* **502 Bad Gateway：**通常是服务器作为网关或代理时返回的错误码，表示服务器自身工作正常，访问后端服务器发生了错误
* 503 Service Unavailable：服务器暂时处于超负载或正在进行停机维护，现在无法处理请求

#### HTTP 工作原理

1. 客户端连接到 Web 服务器
2. 发送 HTTP 请求
3. 服务器接受请求并返回 HTTP 响应
4. 释放 TCP 连接
5. 客户端浏览器解析 HTML 内容